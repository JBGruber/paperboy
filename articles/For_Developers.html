<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>For Developers • paperboy</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="For Developers">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">paperboy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.7.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/For_Developers.html">For Developers</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JBGruber/paperboy/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>For Developers</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JBGruber/paperboy/blob/main/vignettes/For_Developers.Rmd" class="external-link"><code>vignettes/For_Developers.Rmd</code></a></small>
      <div class="d-none name"><code>For_Developers.Rmd</code></div>
    </div>

    
    
<p>This vignette shows you how to write your own parser for a new site.
Feel free to either use your parser locally or (preferably) contribute
it back to the package via a <a href="https://github.com/JBGruber/paperboy/pulls" class="external-link">pull request</a>.</p>
<p>If you want to contribute, your first steps should be to check if the
parser you are looking for is already available (you can use
<code><a href="../reference/pb_available.html">pb_available()</a></code> for that), or if someone has already
committed to working on it in <a href="https://github.com/JBGruber/paperboy/issues" class="external-link">an issue</a> and if
this is not the case, you should <a href="https://github.com/JBGruber/paperboy/issues/new" class="external-link">open a new
issue</a> to let others know you want to do it.</p>
<p>The next step is to get some test data, that means URLs from the page
you want to scrape. I like to use Media Cloud for that, which has an
excellent R package we can employ here (the code below assumes you’ve
already set <code>MEDIACLOUD_API_KEY</code>). So let’s walk through the
process with huffpost.com as an example. We first need the internal ID
of the site on Media cloud and then ask for 500 articles dating back a
week from today</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mediacloud</span><span class="op">)</span></span>
<span><span class="fu">search_media</span><span class="op">(</span><span class="st">"huffpost"</span><span class="op">)</span></span>
<span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">search_stories</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"*"</span>,</span>
<span>                            media_id <span class="op">=</span> <span class="fl">27502</span>,</span>
<span>                            after_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">7</span>,</span>
<span>                            n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>Next, you can collect the raw data of a few of these URLs to
investigate the needed html identifiers:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JBGruber/paperboy" class="external-link">paperboy</a></span><span class="op">)</span></span>
<span><span class="va">articles_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pb_collect.html">pb_collect</a></span><span class="op">(</span><span class="va">test_data</span><span class="op">$</span><span class="va">url</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>This pulls the entire sites of each article from the net. If it
doesn’t, you probably need to set some cookies first (vignette on
cookies coming soon). In most cases, it does not make much sense though
to look at the data with e.g., <code><a href="https://rdrr.io/r/utils/View.html" class="external-link">View()</a></code>, since the html data
is relatively big and the viewer might crash. Instead,
<code>paperboy</code> comes with a function to inspect the code in your
browser:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pb_inspect.html">pb_inspect</a></span><span class="op">(</span><span class="va">articles_raw</span>, <span class="fl">1L</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="inspect.png" alt="view of a collected site with pb_inspect"><div class="figcaption">view of a collected site with pb_inspect</div>
</div>
<p>From here we want to identify at least the headline, article text,
publication date and time, and the author(s). Use the tools you are most
comfortable with, I usually just right-click and <code>Inspect</code> in
Chromium and then look for a suitable CSS tag. To get better with tags,
I recommend the cool game <a href="https://flukeout.github.io/" class="external-link">CSS
Diner</a>.</p>
<p>Once you know roughly how the site publishes articles, you can start
a new parser which pulls the relevant information from the html code.
The best way to start is from the built-in template using the
un-exported function <code><a href="../reference/pb_new.html">pb_new()</a></code>. Just enter the domain of the
site (or an entire URL) to create the correct function (the new file
will be placed in your working directory or the /R directory if you work
in the package folder):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paperboy</span><span class="fu">:::</span><span class="fu"><a href="../reference/pb_new.html">pb_new</a></span><span class="op">(</span>np <span class="op">=</span> <span class="st">"http://huffpost.com/"</span><span class="op">)</span></span></code></pre></div>
<p>If you are familiar with <code>rvest</code>, you should have no
problem making the parser work in minutes. Feel free to look at the
available parsers for inspiration. To make the process even easier,
<code>paperboy</code> adds the function <code>html_search</code> which
can search through multiple CSS identifiers and node attributes at once.
As an example, have a look at the default parser, which is designed to
grab data from many different sites:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/html_search.html">html_search</a></span><span class="op">(</span>selectors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"[property=\"sailthru.title\"]"</span>,</span>
<span>      <span class="st">"[property=\"og:title\"]"</span>,</span>
<span>      <span class="st">".headline__title"</span>,</span>
<span>      <span class="st">".headline__subtitle"</span>,</span>
<span>      <span class="st">".js-headline"</span>,</span>
<span>      <span class="st">".headline"</span>,</span>
<span>      <span class="st">".pg-headline"</span>,</span>
<span>      <span class="st">".headline&gt;h1"</span>,</span>
<span>      <span class="st">".headline__text"</span>,</span>
<span>      <span class="st">"[property =\"mol:headline\"]"</span>,</span>
<span>      <span class="st">"[id*=\"video-headline\"]"</span>,</span>
<span>      <span class="st">"title"</span></span>
<span>    <span class="op">)</span>, attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"content"</span>, <span class="st">"text"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It looks through all the listed selectors and retrieves the attribute
content or the text of the node if anything is found (note you can set
<code>all = FALSE</code> to only collect the first non empty node).</p>
<p>The most difficult decision for most parsers is which CSS tags to
choose. There is usually a tradeoff between a more specific parser that
provides clean data and a more general parser that causes fewer problems
when it comes to maintaining different formats on the same website. A
good example is the text column, which you can produce almost always
like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">html</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span><span class="st">"p"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>This selects all paragraphs on a site, which often also includes
irrelevant data, such as infos for subscribers, ads, readers’ comments
or even meta data that is usually hidden from view. So it is usually
better to do something like this instead:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">html</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span><span class="st">".article-body&gt;p"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rvest</span><span class="fu">::</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text2</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>This code will only select paragraphs from the article-body class,
which works well for most washingtonpost.com articles, for example.
However, not all articles on the website have this class, for which case
you want to create a fallback. <code><a href="../reference/html_search.html">html_search()</a></code> can do this
like shown below:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">text</span> <span class="op">&lt;-</span> <span class="va">html</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/html_search.html">html_search</a></span><span class="op">(</span>selectors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".article-body&gt;p"</span>, <span class="st">"p"</span><span class="op">)</span>, <span class="co"># select paragraphs in .article-body or just all paragraphs</span></span>
<span>              attributes <span class="op">=</span> <span class="st">"text"</span>,                   <span class="co"># retrieve the text from selected nodes</span></span>
<span>              all <span class="op">=</span> <span class="cn">FALSE</span>,                           <span class="co"># only the first non-empty match is used</span></span>
<span>              n <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                           <span class="co"># default is to return the first attribute, we want all paragraphs</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>Another notable helper function is <code>s_n_list</code> (for safe
named list), which combines multiple R objects into a named list in
which all elements have the length 1. The returned value of
<code>s_n_list</code> should be the output of all parsers:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="co"># longer objects are put in a list</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># NULL is turned into NA</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="fu">paperboy</span><span class="fu">:::</span><span class="fu">s_n_list</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   a          b     c    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Combining the data in this way makes sure the data can be neatly
placed in a tibble later. You should still make sure though that the
objects <em>headline</em>, <em>article</em>, <em>datetime</em>, and
<em>author</em> have length 1 (with <code><a href="https://rdrr.io/r/base/toString.html" class="external-link">toString()</a></code> and
<code>head(x, 1L)</code> respectively). You can also include additional
fields in your parser if this makes sense in a specific case. The
huffpost, for example, also distributes videos, so the <em>type</em>
field is constructed and will be moved to the <code>misc</code> column
automatically.</p>
<p>Once you think the parser is ready for a test drive, use the raw html
data from above and turn on debugging mode (with
<code>verbose = 2L</code>) to see where the parser might still fail. To
run the function through <code>pb_deliver</code> you just load your new
function into the global environment and it should be picked up (since
the template uses unexported functions, you should also run
<code>devtools::load_all()</code>, so <code>R</code> can find them):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">articles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pb_deliver.html">pb_deliver</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">articles_raw</span>, verbose <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span></code></pre></div>
<p>Look through the articles to see if anything is missing that should
be there. For the huffpost data, for example, the author was missing
around half the time until I discovered that the html class is either
<code>.author-card__name</code> <em>or</em>
<code>.entry-wirepartner__byline</code> depending on if the author was a
huffpost writer.</p>
<p>Finally, you should check the new parser against the entire test data
from above:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">articles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pb_deliver.html">pb_deliver</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">test_data</span><span class="op">$</span><span class="va">url</span><span class="op">)</span></span></code></pre></div>
<p>If it works well here too, the parser is ready for serious duty
:)</p>
<!-- TODO: add description how to write tests -->
<!-- registerS3method("pb_deliver", "www_huffpost_com", pb_deliver_paper.www_huffpost_com) -->
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Johannes B. Gruber.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
